# Dyno Scheduler - Wake up and keep dynos warm during active hours
# Helps manage the 2000 hour limit across 6 Eco dynos
# Schedule: 10:00 AM - 08:00 PM Uzbekistan time (UTC+5) = 05:00 - 15:00 UTC
# 6 dynos √ó 10 hours/day √ó 30 days = 1,800 hours/month (under 2,000 limit)
#
# ‚ö†Ô∏è DISABLED FOR JANUARY 2026 - Re-enable in February
# Uncomment the schedule section below when ready to resume

name: Dyno Scheduler

on:
  # DISABLED - Uncomment below to enable automatic scheduling
  # schedule:
  #   # Wake up dynos at 05:00 UTC (10:00 AM Uzbekistan time)
  #   - cron: '0 5 * * *'
  #   # Ping every hour from 06:00-15:00 UTC (11:00 AM - 08:00 PM Uzbekistan time)
  #   - cron: '0 6-15 * * *'
  workflow_dispatch:  # Manual trigger only for now

jobs:
  wake-dynos:
    runs-on: ubuntu-latest
    name: Wake/Ping Dynos

    steps:
      - name: Ping API Gateway
        run: |
          echo "Pinging API Gateway..."
          curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.HEROKU_APP_API_GATEWAY }}.herokuapp.com/actuator/health || true

      - name: Ping Auth Service
        run: |
          echo "Pinging Auth Service..."
          curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.HEROKU_APP_AUTH }}.herokuapp.com/actuator/health || true

      - name: Ping Wallet Service
        run: |
          echo "Pinging Wallet Service..."
          curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.HEROKU_APP_WALLET }}.herokuapp.com/actuator/health || true

      - name: Ping Customer Service
        run: |
          echo "Pinging Customer Service..."
          curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.HEROKU_APP_CUSTOMER }}.herokuapp.com/actuator/health || true

      - name: Ping Ledger Service
        run: |
          echo "Pinging Ledger Service..."
          curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.HEROKU_APP_LEDGER }}.herokuapp.com/actuator/health || true

      - name: Ping Notification Service
        run: |
          echo "Pinging Notification Service..."
          curl -s -o /dev/null -w "%{http_code}" https://${{ secrets.HEROKU_APP_NOTIFICATION }}.herokuapp.com/actuator/health || true

      - name: Summary
        run: |
          echo "‚úÖ All dynos pinged successfully"
          echo "üí° Dynos will auto-sleep after 30 minutes of inactivity (after 08:00 PM Uzbekistan time / 15:00 UTC)"

